<html > 
<head><title>The implementation glade-based</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- html,2,info,next,mouseover,no-DOCTYPE --> 
<meta name="src" content="tutorial.tex"> 
<meta name="date" content="2009-03-31 17:46:00"> 
<link rel="stylesheet" type="text/css" href="tutorial.css"> 
<script type="text/javascript" src="tutorial-js.js"></script> 
<script type="text/javascript" src="overlib.js"><!-- overLIB (c) Erik Bosrup --></script> <!--http://www.bosrup.com/web/overlib/--></head><body 
><div id="overDiv" style="position:absolute; visibility:hidden; z-index:1000;"></div> 
   <!--l. 125--><div class="crosslinks"><p class="noindent">[<a 
href="tutorialse5.html" >next</a>] [<a 
href="tutorialse3.html" >prev</a>] [<a 
href="tutorialse3.html#tailtutorialse3.html" >prev-tail</a>] [<a 
href="#tailtutorialse4.html">tail</a>] [<a 
href="tutorial.html#tutorialse4.html" >up</a>] </p></div>
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x6-50004"></a>The implementation glade-based</h3>
<!--l. 127--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.1   </span> <a 
 id="x6-60004.1"></a>The model</h4>
<!--l. 128--><p class="noindent" >The model is represented by class <span id="textcolor1"><span 
class="cmtt-10">MyModel</span></span>, derived from class <span id="textcolor2"><span 
class="cmtt-10">Model</span></span>, that in turn is
provided by the framework.
<!--l. 131--><p class="indent" >   The class <span id="textcolor3"><span 
class="cmtt-10">MyModel</span></span> contains a field called <span id="textcolor4"><span 
class="cmtt-10">counter</span></span> to hold the value of a numeric
counter. Since we are interested in monitoring and show any change of this counter,
we declare it as an <span 
class="cmti-10">observable property</span>.
                                                                  

                                                                  
   <div class="verbatim">
from&#x00A0;gtkmvc.model&#x00A0;import&#x00A0;Model
&#x00A0;<br />
&#x00A0;<br />class&#x00A0;MyModel&#x00A0;(Model):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;observable&#x00A0;properties:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;counter&#x00A0;=&#x00A0;0
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;__observables__&#x00A0;=&#x00A0;(&#8217;counter&#8217;,)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;pass&#x00A0;#&#x00A0;end&#x00A0;of&#x00A0;class
</div>
<!--l. 147--><p class="nopar" >
<!--l. 150--><p class="indent" >   All that it is required to do, is calling class <span id="textcolor5"><span 
class="cmtt-10">Model</span></span>&#8217;s constructor from within the
derived class&#8217; constructor, and defining a class variable <span id="textcolor6"><span 
class="cmtt-10">_</span><span 
class="cmtt-10">_observables</span><span 
class="cmtt-10">_</span><span 
class="cmtt-10">_</span></span> containing
the name of the observable properties. The base class <span id="textcolor7"><span 
class="cmtt-10">Model</span></span> will do all the boring
work automatically.
<!--l. 156--><p class="indent" >   Names in <span id="textcolor8"><span 
class="cmtt-10">_</span><span 
class="cmtt-10">_observables</span><span 
class="cmtt-10">_</span><span 
class="cmtt-10">_</span></span> can contain wilcards, see the user manual for further
information.
<!--l. 159--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.2   </span> <a 
 id="x6-70004.2"></a>The glade-based view</h4>
<!--l. 160--><p class="noindent" ><span 
class="cmsl-10">Glade </span>while editing the example is depicted in figure <a 
href="#x6-70012">2<!--tex4ht:ref: fig:glade --></a>. The names for the main
window, the label and the button are significant, and signal clicked of the button has
been associated with a function called <span id="textcolor9"><span 
class="cmtt-10">on</span><span 
class="cmtt-10">_button</span><span 
class="cmtt-10">_clicked</span></span>.
<!--l. 165--><p class="indent" >   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                  

                                                                  
<a 
 id="x6-70012"></a>
                                                                  

                                                                  
<div class="center" 
>
<!--l. 166--><p class="noindent" >

<!--l. 167--><p class="noindent" ><img 
src="png/glade.png" alt="PIC"  
>
<br /> <table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;2: </td><td  
class="content"><span 
class="cmsl-10">Glade </span>at work</td></tr></table><!--tex4ht:label?: x6-70012 -->
</div>
                                                                  

                                                                  
<!--l. 170--><p class="indent" >   </td></tr></table></div><hr class="endfigure">
<!--l. 173--><p class="indent" >   The result is saved in file <span 
class="cmtt-10">pygtkmvc-example.glade</span>.
<!--l. 175--><p class="indent" >   The view is represented by class <span id="textcolor10"><span 
class="cmtt-10">MyView</span></span>, that derives from class <span id="textcolor11"><span 
class="cmtt-10">View</span></span>
provided by <span 
class="cmti-10">pygtkmvc</span>. The class <span id="textcolor12"><span 
class="cmtt-10">View</span></span> can be thought as a container that
holds a set of widgets, and may associate each widget with a string name.
When a glade file is used to build the view, each widget will be associated
automatically inside the view with the corresponding name occurring in the glade
file.
<!--l. 182--><p class="indent" >   later, each <span id="textcolor13"><span 
class="cmtt-10">View</span></span> instance is connected to a corresponding <span id="textcolor14"><span 
class="cmtt-10">Controller</span></span>,
and when built from a glade file, methods inside the <span id="textcolor15"><span 
class="cmtt-10">Controller</span></span> will be
scanned to try to connect automatically all signals declared in the glade
file.
                                                                  

                                                                  
   <div class="verbatim">
from&#x00A0;gtkmvc.model&#x00A0;import&#x00A0;Model
&#x00A0;<br />
&#x00A0;<br />#&#x00A0;This&#x00A0;is&#x00A0;file&#x00A0;model.py
&#x00A0;<br />from&#x00A0;gtkmvc.view&#x00A0;import&#x00A0;View
&#x00A0;<br />
&#x00A0;<br />class&#x00A0;MyView&#x00A0;(View):
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;def&#x00A0;__init__(self):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;View.__init__(self,&#x00A0;&#8217;pygtkmvc-example.glade&#8217;)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;return
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;some&#x00A0;special&#x00A0;methods&#x00A0;for&#x00A0;setting&#x00A0;this&#x00A0;view...
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;pass&#x00A0;#&#x00A0;end&#x00A0;of&#x00A0;class
</div>
<!--l. 203--><p class="nopar" >
<!--l. 206--><p class="indent" >   Class <span id="textcolor16"><span 
class="cmtt-10">MyView</span></span> calls simply <span id="textcolor17"><span 
class="cmtt-10">View</span></span>&#8217;s class constructor from within its constructor,
by passing the glade file name. All the hard work is carried out by class
<span id="textcolor18"><span 
class="cmtt-10">View</span></span>.
<!--l. 210--><p class="indent" >   Most of the time user&#8217;s views are like class <span id="textcolor19"><span 
class="cmtt-10">MyView</span></span> here: they derive from <span id="textcolor20"><span 
class="cmtt-10">View</span></span>
and simply call View&#8217;s constructor by passing glade filename and possibly name of
top level widget. In this situation, it is possible to use a much compact declaration
for views:
                                                                  

                                                                  
   <div class="verbatim">
class&#x00A0;MyView2&#x00A0;(View):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;glade&#x00A0;=&#x00A0;&#8217;pygtkmvc-example.glade&#8217;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;pass&#x00A0;#&#x00A0;end&#x00A0;of&#x00A0;class
</div>
<!--l. 221--><p class="nopar" >
<!--l. 224--><p class="indent" >   Another alternative is:
                                                                  

                                                                  
   <div class="verbatim">
class&#x00A0;MyView3&#x00A0;(View):&#x00A0;pass
</div>
<!--l. 229--><p class="nopar" >
<!--l. 232--><p class="indent" >   later when instantiating the view:
                                                                  

                                                                  
   <div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;...
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;v&#x00A0;=&#x00A0;MyView3(glade=&#8217;pygtkmvc-example.glade&#8217;)
</div>
<!--l. 237--><p class="nopar" >
<!--l. 240--><p class="indent" >   Similarly, it is possible to to the same for top-level widget (or widgets) with
member or parameter <span id="textcolor21"><span 
class="cmtt-10">top</span></span>.
   <h4 class="subsectionHead"><span class="titlemark">4.3   </span> <a 
 id="x6-80004.3"></a>The controller</h4>
<!--l. 245--><p class="noindent" >The controller - so to speak - is the most complicated part of this example. It is the
only part of the <span 
class="cmti-10">MVC </span>pattern which knows the model and the view instances which
it is linked to. These are accessible via members <span id="textcolor22"><span 
class="cmtt-10">self.model</span></span> and <span id="textcolor23"><span 
class="cmtt-10">self.view</span></span>
respectively.
                                                                  

                                                                  
   <div class="verbatim">
#&#x00A0;This&#x00A0;is&#x00A0;file&#x00A0;ctrl_glade.py
&#x00A0;<br />from&#x00A0;gtkmvc&#x00A0;import&#x00A0;Controller
&#x00A0;<br />import&#x00A0;gtk
&#x00A0;<br />
&#x00A0;<br />class&#x00A0;MyController&#x00A0;(Controller):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;def&#x00A0;__init__(self,&#x00A0;model,&#x00A0;view):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Controller.__init__(self,&#x00A0;model,&#x00A0;view)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;The&#x00A0;controller&#x00A0;is&#x00A0;an&#x00A0;observer&#x00A0;for&#x00A0;properties&#x00A0;contained&#x00A0;in
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;the&#x00A0;model:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;return
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;def&#x00A0;register_view(self,&#x00A0;view):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;"""This&#x00A0;method&#x00A0;is&#x00A0;called&#x00A0;by&#x00A0;the&#x00A0;view,&#x00A0;that&#x00A0;calls&#x00A0;it&#x00A0;when&#x00A0;it&#x00A0;is
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;ready&#x00A0;to&#x00A0;register&#x00A0;itself.&#x00A0;Here&#x00A0;we&#x00A0;connect&#x00A0;the&#x00A0;&#8217;pressed&#8217;&#x00A0;signal
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;of&#x00A0;the&#x00A0;button&#x00A0;with&#x00A0;a&#x00A0;controller&#8217;s&#x00A0;method.&#x00A0;Signal&#x00A0;&#8217;destroy&#8217;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;for&#x00A0;the&#x00A0;main&#x00A0;window&#x00A0;is&#x00A0;handled&#x00A0;as&#x00A0;well."""
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;connects&#x00A0;the&#x00A0;signals:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;self.view[&#8217;main_window&#8217;].connect(&#8217;destroy&#8217;,&#x00A0;gtk.main_quit)
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;initializes&#x00A0;the&#x00A0;text&#x00A0;of&#x00A0;label:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;self.view[&#8217;label&#8217;].set_text("%d"&#x00A0;%&#x00A0;self.model.counter)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;return
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;signals:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;def&#x00A0;on_button_clicked(self,&#x00A0;button):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;self.model.counter&#x00A0;+=&#x00A0;1&#x00A0;&#x00A0;#&#x00A0;changes&#x00A0;the&#x00A0;model
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;return
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;observable&#x00A0;properties:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;def&#x00A0;property_counter_value_change(self,&#x00A0;model,&#x00A0;old,&#x00A0;new):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;self.view[&#8217;label&#8217;].set_text("%d"&#x00A0;%&#x00A0;new)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;print&#x00A0;"Property&#x00A0;&#8217;counter&#8217;&#x00A0;changed&#x00A0;value&#x00A0;from&#x00A0;%d&#x00A0;to&#x00A0;%d"&#x00A0;%&#x00A0;(old,&#x00A0;new)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;return
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;pass&#x00A0;#&#x00A0;end&#x00A0;of&#x00A0;class
</div>
<!--l. 289--><p class="nopar" >
<!--l. 292--><p class="indent" >   In the class constructor, at first base class constructor is called, passing the <span id="textcolor24"><span 
class="cmtt-10">Model</span></span>
instance this <span id="textcolor25"><span 
class="cmtt-10">Controller</span></span> instance belongs to. From that moment on, class member
self.model will be accessible.
<!--l. 297--><p class="indent" >   <span id="textcolor26"><span 
class="cmtt-10">Controller</span></span>&#8217;s base class <span id="textcolor27"><span 
class="cmtt-10">Observer</span></span> calls method <span id="textcolor28"><span 
class="cmtt-10">Model.register</span><span 
class="cmtt-10">_observer</span></span> in
order to make the controller an observer for the observable property <span id="textcolor29"><span 
class="cmtt-10">counter</span></span> in the
model. After this, every change applied to <span id="textcolor30"><span 
class="cmtt-10">MyModel</span></span> class&#8217; member <span id="textcolor31"><span 
class="cmtt-10">counter</span></span> will make
method <span id="textcolor32"><span 
class="cmtt-10">property</span><span 
class="cmtt-10">_counter</span><span 
class="cmtt-10">_value</span><span 
class="cmtt-10">_change</span></span> of class <br 
class="newline" /><span id="textcolor33"><span 
class="cmtt-10">MyController</span></span> be called automatically.
<!--l. 305--><p class="indent" >   At construction time also the <span id="textcolor34"><span 
class="cmtt-10">View</span></span> instance is passed, to be registered to be the
view of the controller.
<!--l. 308--><p class="indent" >   Method <span id="textcolor35"><span 
class="cmtt-10">register</span><span 
class="cmtt-10">_view</span></span> is called when a class <span id="textcolor36"><span 
class="cmtt-10">View</span></span> instance requires to be
registered to the controller it belongs to. This method is mainly used to connect
signals and initialize the <span 
class="cmti-10">GUI </span>side that depends on the application logic. In the
example, signal <span id="textcolor37"><span 
class="cmtt-10">"destroy"</span></span> of the main window is connected to <span id="textcolor38"><span 
class="cmtt-10">gtk.main</span><span 
class="cmtt-10">_quit</span></span> to
close the application when the user closes the window. Notice here the use of member
<span id="textcolor39"><span 
class="cmtt-10">self.view</span></span> and how a class <span id="textcolor40"><span 
class="cmtt-10">View</span></span> can be used as a map to retrieve widgets from their
names.
<!--l. 318--><p class="indent" >   Also, the text label is initialized to the initial value of the counter.
<!--l. 321--><p class="indent" >   Method <span id="textcolor41"><span 
class="cmtt-10">on</span><span 
class="cmtt-10">_button</span><span 
class="cmtt-10">_clicked</span></span> is called as a callback every time the user clicks the
button. The corresponding signal is automatically connected to this method when
class <span id="textcolor42"><span 
class="cmtt-10">MyView</span></span> registers itself within the controller.
<!--l. 326--><p class="indent" >   Finally, method <span id="textcolor43"><span 
class="cmtt-10">property</span><span 
class="cmtt-10">_counter</span><span 
class="cmtt-10">_value</span><span 
class="cmtt-10">_change</span></span> is called when the property
counter in class <span id="textcolor44"><span 
class="cmtt-10">MyModel</span></span> changes. The model containing the property, the old value
and the new value are passed to this method. Notice that the model is passed
since the controller might be an observer for more than one model, even
different from the model it is directly connected to in the <span 
class="cmti-10">MVC </span>pattern
chain.
<!--l. 335--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.4   </span> <a 
 id="x6-90004.4"></a>The main code</h4>
<!--l. 336--><p class="noindent" >Main code is pretty trivial:
                                                                  

                                                                  
   <div class="verbatim">
#&#x00A0;This&#x00A0;is&#x00A0;file&#x00A0;main_glade.py
&#x00A0;<br />import&#x00A0;gtk
&#x00A0;<br />from&#x00A0;model&#x00A0;import&#x00A0;MyModel
&#x00A0;<br />from&#x00A0;ctrl_glade&#x00A0;import&#x00A0;MyController
&#x00A0;<br />from&#x00A0;view_glade&#x00A0;import&#x00A0;MyView
&#x00A0;<br />
&#x00A0;<br />m&#x00A0;=&#x00A0;MyModel()
&#x00A0;<br />v&#x00A0;=&#x00A0;MyView()
&#x00A0;<br />c&#x00A0;=&#x00A0;MyController(m,&#x00A0;c)
&#x00A0;<br />
&#x00A0;<br />gtk.main()
</div>
<!--l. 351--><p class="nopar" >
<!--l. 354--><p class="indent" >   A triple MVC is created, and main loop is started.
                                                                  

                                                                  
   <!--l. 357--><div class="crosslinks"><p class="noindent">[<a 
href="tutorialse5.html" >next</a>] [<a 
href="tutorialse3.html" >prev</a>] [<a 
href="tutorialse3.html#tailtutorialse3.html" >prev-tail</a>] [<a 
href="tutorialse4.html" >front</a>] [<a 
href="tutorial.html#tutorialse4.html" >up</a>] </p></div>
<!--l. 357--><p class="indent" >   <a 
 id="tailtutorialse4.html"></a>   
</body></html> 
